(function(){"use strict";function isChildOf(c,p){do{c=c.parentNode}while(c!==p&&c!=null);return c!=null}function html(tag="div",attr=null,children=[]){const el=document.createElement(tag);let value;Object.entries(attr||{}).forEach(([key,val])=>{if(key[0]==="$"){el.addEventListener(key.substr(1),val)}else if(key[0]==="_"){if(tag==="select"&&key==="_value"){value=val}else{el[key.substr(1)]=val}}else if(key==="class"){el.classList.add(...val.split(" "))}else if(key==="text"){el.innerText=val}else{el.setAttribute(key,val)}});children.forEach(c=>el.appendChild(c));if(value!=null){el.value=value}return el}class BaseComponent{constructor(events){this.events=events}event(e,name,...params){if(this.events!=null&&typeof this.events[name]==="function"){this.events[name](...params)}e.stopPropagation()}}class HeaderComponent extends BaseComponent{constructor(parent,events){super(events);this.render(parent)}render(parent){this.el=parent.appendChild(html("header",null,[html("input",{type:"search",placeholder:"Search...",$input:e=>this.event(e,"onSearch",e.target.value)}),html("a",{href:"#",class:"btn",text:"Add Note",$click:e=>this.event(e,"onAdd")})]))}}const noteList=[];let searchText="";class NotesComponent extends BaseComponent{constructor(events){super(events);this.el=document.body.appendChild(html("ul",{class:"notes"}));this.load().render()}get nextId(){this.lastId+=1;return this.lastId}search(text){searchText=text.toLowerCase();this.render()}new(){return Object.assign({},{id:-1,subject:"",content:"",category:"Normal"})}delete(note){const ix=noteList.findIndex(n=>n.id===note.id);if(ix>=0){noteList.splice(ix,1)}this.save().render()}update(note){if(note.id===-1){note.id=this.nextId;noteList.push(note)}else{const ix=noteList.findIndex(n=>n.id===note.id);noteList[ix]=note}this.save().render()}render(){this.el.innerHTML="";noteList.filter(r=>searchText===""||Object.values(r).some(v=>v.toLowerCase().includes(searchText))).map(rec=>html("li",{class:rec.category.toLowerCase(),$click:e=>this.event(e,"onEdit",rec)},[html("h2",{text:rec.subject}),html("h3",{text:rec.category}),html("p",{text:rec.content})])).forEach(li=>this.el.append(li))}load(){noteList.length=0;noteList.push(...JSON.parse(localStorage.getItem("notes"))||[]);this.lastId=noteList.reduce((pv,v)=>v.id>pv?v.id:pv,0);return this}save(){localStorage.setItem("notes",JSON.stringify(noteList));return this}}class NoteForm extends BaseComponent{constructor(){super();document.body.addEventListener("mousedown",e=>{if(this.el!=null&&e.target!==this.el&&!isChildOf(e.target,this.el)){this.close()}})}get data(){return Object.assign(this.note,Object.fromEntries(Array.from(this.el.querySelectorAll("[name]").values()).map(e=>[e.getAttribute("name"),e.value])))}event(e,name,...params){this.close();super.event(e,name,...params)}render(note){this.el=document.body.appendChild(html("div",{id:"new-note-form"}));[html("label",{text:"Subject:"},[html("input",{name:"subject",type:"text",focus:true,_value:note.subject})]),html("label",{text:"Content:"},[html("textarea",{name:"content",type:"text",_value:note.content})]),html("select",{text:"Category:",name:"category",_value:note.category},[html("option",{text:"Important"}),html("option",{text:"Normal"}),html("option",{text:"Disabled"})]),html("a",{href:"#",text:"Save",class:"btn btn-save",$click:e=>this.event(e,"onSave",this.data)}),note.id!==-1?html("a",{href:"#",text:"Delete",class:"btn btn-delete",$click:e=>this.event(e,"onDelete",this.data)}):null,html("a",{href:"#",_innerHTML:"&times;",class:"btn-close",$click:()=>this.close()})].filter(e=>e!=null).forEach(e=>this.el.appendChild(e));this.el.querySelector("[focus]").focus()}close(){this.el.remove();this.el=undefined}edit(note,events){this.note=note;this.events=events;this.render(note)}}const noteForm=new NoteForm;const header=new HeaderComponent(document.body,{onSearch(text){notes.search(text)},onAdd(){noteForm.edit(notes.new(),{onSave(note){notes.update(note)}})}}),notes=new NotesComponent({onEdit(note){noteForm.edit(note,{onSave(note){notes.update(note)},onDelete(note){notes.delete(note)}})}})})();